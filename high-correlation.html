<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>
<title> Chicago Crime Correlations - Ari Greenberg</title>
<style> /* set the CSS */

.line {
  fill: none;
  stroke-width: 3px;
}

.police {
  stroke: steelblue;
}
.violent {
  stroke: red;
}
.other {
  stroke: #ff4f2a;
}
.social {
  stroke: #00cc88;
}

.lineLabel {
  text-anchor:middle;
}

.text {
  font-size: 16px;
}

.desc {
  display:none;
  width:80%;
}

.descP {
  border-style: double;
  font-size:22px;
}
.dataLabel {
  background-color: #f18973;
}

#topDesc {
  width:80%;
  background-color: powderblue;
  font-size:22px;
  left: 60px;
}

#secondButton {
  display:none;
}

</style>
</head>
<body>
<h1>
  Examining the Correlation Between Police Funding, Social Services, and Crime in Chicago.
</h1>
<div id = "topDesc">
<p style="border-style: double">
  The graph below demonstrates the correlation between <i>increased funding</i> for the Police Bureau of Organized Crime Investigations and the <i>decrease in various crimes</i>.
<br>
<strong>
  The Police Bureau of Organized Crime Investigations is the bureau which:
</strong>
<b>
  Coordinates the identification, investigation, and prosecution of individuals, street gangs, and other organizations engaged in criminal or terrorist activity.
</b>
</p>
</div>

<!-- load the d3.js library -->   
<script src ="data.js"> </script>
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>

var secondButtonLoaded = 0;
var colors = ["steelblue", "red", "#ff4f2a", "#00cc88"];

// set the dimensions and margins of the graph
var margin = {top: 50, right: 50, bottom: 50, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// append the svg obgect to the body of the page
// appends a 'group' element to 'svg'
// moves the 'group' element to the top left margin
var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

  // format the data
  highcor1.forEach(function(d) {
    d.name = d.name;
    d.corr = +d.corr;
  });

  // Scale the range of the data
  // set the ranges
  var x = d3.scaleBand()
    .domain(highcor1.map(function(d) { return d.name; }))
    .range([0, width]);

  var y = d3.scaleLinear()
    .domain([d3.min(data, function(d) { return d.corr;}), d3.max(data, function(d) { return d.corr;})])
    .range([height, 0]);

  svg.append("text")
    .attr("x", width/2)
    .attr("y", height+35)
    .style("text-anchor", "middle")
    .text("Category");

   svg.append("text")
    .attr("x", -70)
    .attr("y", 15)
    .attr("transform", "rotate(-90)")
    .style("text-anchor", "middle")
    .text("Correlation coefficient");

  svg.append("text")
    .attr("x", width/2)
    .attr("y", 20)
    .attr('class', 'lineLabel')
    .text("");

  var bar = d3.line()
    .x(d => x(d.name))
    .y(d => y(d.corr));

  let bars = svg.append('g');

  bars.selectAll('.bar_group')
    .data(highcor1).enter()
    .append('rect')
    .attr("x", function(d) { return x(d.name); })
    .attr("y", function(d) { return y(Math.max(0, d.corr)); })
    .attr("width", x.bandwidth())
    .attr("height", function(d) { return Math.abs(y(d.corr) - y(0));});
    /*.on('mouseover', function (d) {
      d3.selectAll('.line')
      .style("stroke", "gainsboro");
      id = "#"+d.name+"Line";
      d3.select(id)
      .style("stroke", "black")
      .style("stroke-width", "6px")
      .style("cursor", "pointer");
      d3.select(".lineLabel")
      .style("text-anchor", "middle")
      .style("fill", colors[titleMapping.get(id).num])
      .text(titleMapping.get(id).category);
    })
    .on('mouseout', function(d) {
      d3.selectAll('.line')
      .style("stroke", null)
      .style("stroke-width", null);
      d3.select("#topChartLineLabel")
      .text('No Line Selected');
      d3.select(".lineLabel")
      .text("");
    })
    .on('click', function(d) {
      id2 = "#"+d.name+"Desc";
      d3.selectAll('.desc')
      .style("display", "none");
      d3.select(id2)
      .style("display", "block")
      .style("color", colors[titleMapping.get(id).num]);
    })
    */
    .attr('class', function(d) {return 'bar ' +d.id;})
    .attr('id', function(d) {return d.id+'Bar';})
    .attr('d', d => bar(d.corr));


  svg.append("path")
      .attr("d", "M 0 213 l 860 0")
      .style("stroke", "black");
  // Add the X Axis
  svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  // Add the Y Axis
  svg.append("g")
      .call(d3.axisLeft(y));

function displayAnnot() {
  d3.select('svg')
  .append('text')
  .attr("x", 700)
  .attr("y", 25)
  .style("text-anchor", "middle")
  .text("In 2020, spending on social programs increased dramatically");
   d3.select('svg')
  .append('text')
  .attr("x", 700)
  .attr("y", 40)
  .style("text-anchor", "middle")
  .text("after Lori Lightfoot replaced Rahm Emanuel as mayor of Chicago.");
  d3.select('svg')
  .append('path')
  .attr("d", "M 700 50 l 160 35")
  .style("stroke", "black");
  d3.select("#firstButton")
  .style("display", "none");
  d3.select("#secondButton")
  .style("display", "block");
}

function openSecPage() {
  window.open("https://apgreenberg.github.io/chicago-violence-d3cs498/high-correlation.html");
}

</script>
<div class="desc" id="policeDesc">
<p class = "descP">
  The categories used to calculate police funding were the CPD Public Safety Audit, CPD Internal Investigation + Legal, the Bureau of Patrol, and the Bureau of Organized Crime (which targets gang violence)
</p>
</div>
<div class="desc" id="violentDesc">
<p class = "descP">
  The categories used to calculate violent crime rates were homocide, rape/sexual assault, robbery, burglary, and assault/battery.
</p>
</div>
<div class="desc" id = "otherDesc">
<p class = "descP">
  The categories used to calculate non-violent crime rates were narcotics and criminal damage.
</p>
</div>
<div class="desc" id = "socialDesc">
<p class = "descP">
  The categories used to calculate social assistance program funding were economic assistance programs, housing subsidies, youth services (to reduce gang affiliation in children), homeless and humanity services (homeless shelters and food assistance), violence prevention programs, and mental health programs.
</p>
</div>
<div id="firstButton">
<button type="button" onclick="displayAnnot()">Next-></button>
</div>
<div id="secondButton">
<button type="button" onclick="openSecPage()">Next-></button>
</div>
</body>
</html>