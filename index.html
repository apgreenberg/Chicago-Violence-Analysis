<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>
<style> /* set the CSS */

.line {
  fill: none;
  stroke-width: 3px;
}

.police {
  stroke: steelblue;
}
.violent {
  stroke: red;
}
.other {
  stroke: #ff4f2a;
}
.social {
  stroke: #00cc88;
}

.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

</style>
</head>
<body>
<h1>
  Examining the Correlation Between Police Funding, Social Services, and Crime in Chicago.
</h1>
<p id="topChartLineLabel">No Line Selected</p>

<!-- load the d3.js library -->   
<script src ="toplevdata.js"> </script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>

<script>

var secondGraphLoaded = 0;
var colors = ["steelblue", "red", "#ff4f2a", "#00cc88"];
var titleMapping = new Map();
titleMapping.set('#policeLine', {desc:"police funding for investigations, foot patrol, and internal review", category:"Police Funding", num:0});
titleMapping.set('#violentLine', {desc:"crimes rates in homicide, rape, robbery, burglary, and battery", category:"Violent Crime", num:1});
titleMapping.set('#otherLine', {desc:"crime rates of narcotics and criminal damage", category:"Non-Violent Crime", num:2});
titleMapping.set('#socialLine', {desc:"city spending on social programs", category:"Social Assistance Program Funding", num:3});
titleMapping.set('#homicideLine', {desc:"homicides", category: "Homicide", num:1});
titleMapping.set('#rapeLine', {desc:"rapes", category:"Rape and Sexual Assault", num:1});
titleMapping.set('#robberyLine', {desc:"robberies", category:"Robbery", num:1});
titleMapping.set('#burglaryLine', {desc:"burglaries", category: "Burglary", num:1});
titleMapping.set('#assaultLine', {desc:"assault/battery", category: "Assault and Battery", num:1});
titleMapping.set('#narcLine', {desc:"narcotics", category:"Narcotics", num:2});
titleMapping.set('#crimdamLine', {desc:"crinimal damage", category:"Criminal Damage", num:2});
titleMapping.set('#econLine', {desc:"crinimal damage", category:"Economic Stimulus Programs", num:3});
titleMapping.set('#houseLine', {desc:"crinimal damage", category:"Housing Assistance Programs", num:3});
titleMapping.set('#youthLine', {desc:"crinimal damage", category:"Youth Programs", num:3});
titleMapping.set('#homelessLine', {desc:"crinimal damage", category:"Homeless and Human Services", num:3});
titleMapping.set('#violenceLine', {desc:"crinimal damage", category:"Violence Prevention Programs", num:3});
titleMapping.set('#mentalLine', {desc:"mental health programs", category:"Mental Health Programs", num:3});
//hover over police line
function highlight(id) {
  console.log(id);
  d3.selectAll('.line')
  .style("stroke", "gainsboro");
  d3.select(id)
  .style("stroke", "black")
  .style("stroke-width", "6px");
  d3.select('.d3-tip')
    .html(function(d) {
    return "<strong>Category:</strong> <span style='color:" + colors[titleMapping.get(id).num] + "'>" + titleMapping.get(id).category + "</span>";})
  //.append("text")
  //.text(titleMapping.get(id).desc);
  d3.select("#topChartLineLabel")
  .text(titleMapping.get(id).desc);
}

function dehighlight() {
  d3.selectAll('.line')
  .style("stroke", null)
  .style("stroke-width", null);
  d3.select("#topChartLineLabel")
  .text('No Line Selected');
}

// set the dimensions and margins of the graph
var margin = {top: 50, right: 50, bottom: 50, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// parse the date / time
var parseTime = d3.timeParse("%Y");

// define the 1st line
var policeline = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d.police); });

// define the 2nd line
var violentline = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d.violent); });

var otherline = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d.other); });

var socialline = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d.social); });

// append the svg obgect to the body of the page
// appends a 'group' element to 'svg'
// moves the 'group' element to the top left margin
var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])


// Get the data
/*d3.csv("crimetimeline.csv", function(error, data) {
  if (error) throw error;
  */

  // format the data
  origData.forEach(function(d) {
      d.values.forEach(function(d) {
        d.year = parseTime(d.year);
        d.percent = +d.percent;
      });
  });

  // Scale the range of the data
  // set the ranges
  var x = d3.scaleTime()
    .domain(d3.extent(origData[0].values, d => d.year))
    .range([0, width]);

  var y = d3.scaleLinear()
    .domain([d3.min(origData[3].values, d=>d.percent), d3.max(origData[3].values, d=>d.percent)])
    .range([height, 0]);

  svg.call(tip);

  svg.append("text")
    .attr("x", width/2)
    .attr("y", height+35)
    .style("text-anchor", "middle")
    .text("Year");

   svg.append("text")
    .attr("x", -70)
    .attr("y", 15)
    .attr("transform", "rotate(-90)")
    .style("text-anchor", "middle")
    .text("% change since previous year");

  var line = d3.line()
    .x(d => x(d.year))
    .y(d => y(d.percent));

  let lines = svg.append('g');



  lines.selectAll('.line_group')
    .data(origData).enter()
    .append('path')
    .attr('class', 'line-group')
    .on("mouseover", function(d) {
      highlight.call(d.name);
    })
    .attr("onmouseout", "dehighlight()")
    .attr('class', function(d) {return 'line ' +d.name;})
    .attr('id', function(d) {return d.name+'Line';})
    .attr('d', d => line(d.values));
  /*// Add the valueline path.
  svg.append("path")
      .data([data])
      .attr("id", "policeLine")
      .attr("class", "line police")
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide)
      .attr("onmouseover", "highlight('#policeLine')")
      .attr("onmouseout", "dehighlight()")
      .attr("onclick", "policefundgraph()")
      .attr("d", policeline);

  // Add the valueline2 path.
  svg.append("path")
      .data([data])
      .attr("id", "violentLine")
      .attr("class", "line violentcrime")
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide)
      .attr("onmouseover", "highlight('#violentLine')")
      .attr("onmouseout", "dehighlight()")
      .attr("onclick", "violentcrimegraph()")
      .attr("d", violentline);

  svg.append("path")
      .data([data])
      .attr("id", "otherLine")
      .attr("class", "line othercrime")
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide)
      .attr("onmouseover", "highlight('#otherLine')")
      .attr("onmouseout", "dehighlight()")
      .attr("onclick", "othercrimegraph()")
      .attr("d", otherline);

  svg.append("path")
      .data([data])
      .attr("id", "socialLine")
      .attr("class", "line socialprog")
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide)
      .attr("onmouseover", "highlight('#socialLine')")
      .attr("onmouseout", "dehighlight()")
      .attr("onclick", "socialproggraph()")
      .attr("d", socialline);
      */
  

  svg.append("path")
      .attr("d", "M 0 213 l 860 0")
      .style("stroke", "black");
  // Add the X Axis
  svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  // Add the Y Axis
  svg.append("g")
      .call(d3.axisLeft(y));

</script>
</body>
</html>