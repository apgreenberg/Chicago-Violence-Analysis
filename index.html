<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>
<style> /* set the CSS */

.line {
  fill: none;
  stroke-width: 3px;
}

.police {
  stroke: steelblue;
}
.violent {
  stroke: red;
}
.other {
  stroke: #ff4f2a;
}
.social {
  stroke: #00cc88;
}

.lineLabel {
  text-anchor:middle;
}

.text {
  font-size: 16px;
}

.desc {
  display:none;
}
.dataLabel {
  background-color: #f18973;
}

#topDesc {
  width:80%;
  background-color: powderblue;
  font-size:16px;
  left: 60px;
}

</style>
</head>
<body>
<h1>
  Examining the Correlation Between Police Funding, Social Services, and Crime in Chicago.
</h1>
<div id = "topDesc">
<p>
  The following slideshow will demonstrate the correlation between police funding, social services and crime in Chicago to help visualize a possible solution to both reduce crime and put funding where it is most effective.
  The graph below demonstrates the year over year percent change in funding for police and social services and the percent change in violent and non-violent crime, using 2012 as a baseline.
</p>
</div>

<!-- load the d3.js library -->   
<script src ="data.js"> </script>
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>

var secondGraphLoaded = 0;
var colors = ["steelblue", "red", "#ff4f2a", "#00cc88"];

// set the dimensions and margins of the graph
var margin = {top: 50, right: 50, bottom: 50, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// parse the date / time
var parseTime = d3.timeParse("%Y");

// append the svg obgect to the body of the page
// appends a 'group' element to 'svg'
// moves the 'group' element to the top left margin
var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

  // format the data
  origData.forEach(function(d) {
      d.values.forEach(function(d) {
        d.year = parseTime(d.year);
        d.percent = +d.percent;
      });
  });

  // Scale the range of the data
  // set the ranges
  var x = d3.scaleTime()
    .domain(d3.extent(origData[0].values, d => d.year))
    .range([0, width]);

  var y = d3.scaleLinear()
    .domain([d3.min(origData[3].values, d=>d.percent), d3.max(origData[3].values, d=>d.percent)])
    .range([height, 0]);

  svg.append("text")
    .attr("x", width/2)
    .attr("y", height+35)
    .style("text-anchor", "middle")
    .text("Year");

   svg.append("text")
    .attr("x", -70)
    .attr("y", 15)
    .attr("transform", "rotate(-90)")
    .style("text-anchor", "middle")
    .text("% change since previous year");

  svg.append("text")
    .attr("x", width/2)
    .attr("y", 20)
    .attr('class', 'lineLabel')
    .text("");

  var line = d3.line()
    .x(d => x(d.year))
    .y(d => y(d.percent));

  let lines = svg.append('g');

  lines.selectAll('.line_group')
    .data(origData).enter()
    .append('path')
    .on('mouseover', function (d) {
      d3.selectAll('.line')
      .style("stroke", "gainsboro");
      id = "#"+d.name+"Line";
      id2 = "#"+d.name+"Desc";
      d3.select(id)
      .style("stroke", "black")
      .style("stroke-width", "6px")
      .style("cursor", "pointer");
      d3.select(".lineLabel")
      .style("text-anchor", "middle")
      .style("fill", colors[titleMapping.get(id).num])
      .text(titleMapping.get(id).category);
      d3.select("id2")
      .style("display", "block")
    })
    .on('mouseout', function(d) {
      d3.selectAll('.line')
      .style("stroke", null)
      .style("stroke-width", null);
      d3.select("#topChartLineLabel")
      .text('No Line Selected');
      d3.select(".lineLabel")
      .text("");
    })
    .attr('class', function(d) {return 'line ' +d.name;})
    .attr('id', function(d) {return d.name+'Line';})
    .attr('d', d => line(d.values));

  lines.selectAll("circle-group")
  .data(origData).enter()
  .append("g")
  .style("fill", "black")
  .selectAll("circle")
  .data(d => d.values).enter()
  .append("g")
  .attr("class", "circle")  
  .on("mouseover", function(d) {
      d3.select(this)     
        .style("cursor", "pointer")
        .append("text")
        .attr("class", "text dataLabel")
        .text(`${d.percent}`)
        .attr("x", d => x(d.year) + 5)
        .attr("y", d => y(d.percent) - 10);
    })
  .on("mouseout", function(d) {
      d3.select(this)
        .style("cursor", "none")  
        .transition()
        .selectAll(".text").remove();
    })
  .append("circle")
  .attr("cx", d => x(d.year))
  .attr("cy", d => y(d.percent))
  .attr("r", 3)
  .style('opacity', '0.85')
  .on("mouseover", function(d) {
        d3.select(this)
          .transition()
          .attr("r", 6);
      })
    .on("mouseout", function(d) {
        d3.select(this) 
          .transition()
          .attr("r", 3);  
      });


  svg.append("path")
      .attr("d", "M 0 213 l 860 0")
      .style("stroke", "black");
  // Add the X Axis
  svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  // Add the Y Axis
  svg.append("g")
      .call(d3.axisLeft(y));

</script>
<div id = "bottomDesc">
</div>
<div class="desc" id="policeDesc">
<p>
  The categories used to calculate police funding were the CPD Public Safety Audit, CPD Internal Investigation + Legal, the Bureau of Patrol, and the Bureau of Organized Crime (which targets gang violence)
</p>
</div>
<div class="desc" id="violentDesc">
<p>
  The categories used to calculate violent crime rates were homocide, rape/sexual assault, robbery, burglary, and assault/battery.
</p>
</div>
<div class="desc" id = "otherDesc">
<p>
  The categories used to calculate non-violent crime rates were narcotics and criminal damage.
</p>
<div class="desc" id = "socialDesc">
<p>
  The categories used to calculate social assistance program funding were economic assistance programs, housing subsidies, youth services (to reduce gang affiliation in children), homeless and humanity services (homeless shelters and food assistance), violence prevention programs, and mental health programs.
</p>
</div>
</body>
</html>